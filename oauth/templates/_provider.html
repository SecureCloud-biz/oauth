{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set title = provider.name~" Settings"|t %}

{% set crumbs = [
    { label: "Settings"|t, url: url('settings') },
    { label: "Plugin"|t, url: url('settings/plugins') },
    { label: "OAuth"|t, url: url('settings/plugins/oauth') }
] %}

{% macro configWarning(setting, file) -%}
    {{ "This is being overridden by the {setting} config setting."|t({
        setting: '<strong>'~setting~'</strong>'
    })|raw }}
{%- endmacro %}

{% from _self import configWarning %}

{% set content %}


    <form method="post" action="" accept-charset="UTF-8">
        <input type="hidden" name="action" value="oauth/providerSave">
        <input type="hidden" name="redirect" value="settings/plugins/oauth" />
        {% if infos %}<input type="hidden" name="providerId" value="{{ infos.id }}" />{% endif %}
        <input type="hidden" name="handle" value="{{ provider.handle }}" />

        <h2 class="first">{{ "Create an OAuth application"|t }}</h2>

        <p>
            {% if provider.consoleUrl %}
                {{ "Create an OAuth 2.0 application and enable associated providers in the {console}"|t({
                    console:           '<a href=\"'~provider.consoleUrl~'\">'~'{provider} API Management Console'|t({provider:provider.name})~'</a>'
                })|raw }}
            {% else %}
                {{ "Create an OAuth 2.0 application and enable associated providers in the API management Console."|t }}
            {% endif %}


        </p>


        <p>{{ "Once created, configure the application with the following settings. You might not need to use all of them."|t }}</p>

        <ul>
            <li><strong>{{ "Web Origin"|t }}:</strong> {{siteUrl}}</li>
            <li><strong>{{ "Redirect URI"|t }}:</strong> {{craft.oauth.callbackUrl(provider.handle)}}</li>
        </ul>

        <hr>

        <h2>{{ "Client ID & Secret"|t }}</h2>

        <p>{{ "Use the client ID & secret from the OAuth application that you've just created."|t }}</p>

        {{ forms.textField({
            label: 'Client Id'|t,
            required: true,
            name: 'provider[clientId]',
            placeholder: infos and infos.clientId is empty ? (configInfos.clientId is defined ? configInfos.clientId) : null,
            value: infos ? infos.clientId : null,
            errors: infos ? infos.errors('clientId') : null,
            warning: (infos and not infos.clientId is empty and configInfos.clientId is defined ? configWarning('oauth.'~provider.handle~'.clientId')),
        }) }}

        {{ forms.textField({
            label: 'Client Secret'|t,
            required: true,
            name: 'provider[clientSecret]',
            placeholder: infos and infos.clientSecret is empty ? (configInfos.clientSecret is defined ? configInfos.clientSecret) : null,
            value: infos ? infos.clientSecret : null,
            errors: infos ? infos.errors('clientSecret') : null,
            warning: (infos and not infos.clientSecret is empty and configInfos.clientSecret is defined ? configWarning('oauth.'~provider.handle~'.clientSecret')),
        }) }}

        <div class="buttons">
            <input class="btn submit" type="submit" value="{{ 'Save'|t }}">
        </div>

    </form>

{% endset %}